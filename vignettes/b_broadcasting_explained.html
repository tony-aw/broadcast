<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>Broadcasting Explained</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>
<script>$(document).ready(function(){
    if (typeof $('[data-toggle="tooltip"]').tooltip === 'function') {
        $('[data-toggle="tooltip"]').tooltip();
    }
    if ($('[data-toggle="popover"]').popover === 'function') {
        $('[data-toggle="popover"]').popover();
    }
});
</script>
<style type="text/css">
.lightable-minimal {
border-collapse: separate;
border-spacing: 16px 1px;
width: 100%;
margin-bottom: 10px;
}
.lightable-minimal td {
margin-left: 5px;
margin-right: 5px;
}
.lightable-minimal th {
margin-left: 5px;
margin-right: 5px;
}
.lightable-minimal thead tr:last-child th {
border-bottom: 2px solid #00000050;
empty-cells: hide;
}
.lightable-minimal tbody tr:first-child td {
padding-top: 0.5em;
}
.lightable-minimal.lightable-hover tbody tr:hover {
background-color: #f5f5f5;
}
.lightable-minimal.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-classic {
border-top: 0.16em solid #111111;
border-bottom: 0.16em solid #111111;
width: 100%;
margin-bottom: 10px;
margin: 10px 5px;
}
.lightable-classic tfoot tr td {
border: 0;
}
.lightable-classic tfoot tr:first-child td {
border-top: 0.14em solid #111111;
}
.lightable-classic caption {
color: #222222;
}
.lightable-classic td {
padding-left: 5px;
padding-right: 5px;
color: #222222;
}
.lightable-classic th {
padding-left: 5px;
padding-right: 5px;
font-weight: normal;
color: #222222;
}
.lightable-classic thead tr:last-child th {
border-bottom: 0.10em solid #111111;
}
.lightable-classic.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-classic.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-classic-2 {
border-top: 3px double #111111;
border-bottom: 3px double #111111;
width: 100%;
margin-bottom: 10px;
}
.lightable-classic-2 tfoot tr td {
border: 0;
}
.lightable-classic-2 tfoot tr:first-child td {
border-top: 3px double #111111;
}
.lightable-classic-2 caption {
color: #222222;
}
.lightable-classic-2 td {
padding-left: 5px;
padding-right: 5px;
color: #222222;
}
.lightable-classic-2 th {
padding-left: 5px;
padding-right: 5px;
font-weight: normal;
color: #222222;
}
.lightable-classic-2 tbody tr:last-child td {
border-bottom: 3px double #111111;
}
.lightable-classic-2 thead tr:last-child th {
border-bottom: 1px solid #111111;
}
.lightable-classic-2.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-classic-2.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-material {
min-width: 100%;
white-space: nowrap;
table-layout: fixed;
font-family: Roboto, sans-serif;
border: 1px solid #EEE;
border-collapse: collapse;
margin-bottom: 10px;
}
.lightable-material tfoot tr td {
border: 0;
}
.lightable-material tfoot tr:first-child td {
border-top: 1px solid #EEE;
}
.lightable-material th {
height: 56px;
padding-left: 16px;
padding-right: 16px;
}
.lightable-material td {
height: 52px;
padding-left: 16px;
padding-right: 16px;
border-top: 1px solid #eeeeee;
}
.lightable-material.lightable-hover tbody tr:hover {
background-color: #f5f5f5;
}
.lightable-material.lightable-striped tbody tr:nth-child(even) {
background-color: #f5f5f5;
}
.lightable-material.lightable-striped tbody td {
border: 0;
}
.lightable-material.lightable-striped thead tr:last-child th {
border-bottom: 1px solid #ddd;
}
.lightable-material-dark {
min-width: 100%;
white-space: nowrap;
table-layout: fixed;
font-family: Roboto, sans-serif;
border: 1px solid #FFFFFF12;
border-collapse: collapse;
margin-bottom: 10px;
background-color: #363640;
}
.lightable-material-dark tfoot tr td {
border: 0;
}
.lightable-material-dark tfoot tr:first-child td {
border-top: 1px solid #FFFFFF12;
}
.lightable-material-dark th {
height: 56px;
padding-left: 16px;
padding-right: 16px;
color: #FFFFFF60;
}
.lightable-material-dark td {
height: 52px;
padding-left: 16px;
padding-right: 16px;
color: #FFFFFF;
border-top: 1px solid #FFFFFF12;
}
.lightable-material-dark.lightable-hover tbody tr:hover {
background-color: #FFFFFF12;
}
.lightable-material-dark.lightable-striped tbody tr:nth-child(even) {
background-color: #FFFFFF12;
}
.lightable-material-dark.lightable-striped tbody td {
border: 0;
}
.lightable-material-dark.lightable-striped thead tr:last-child th {
border-bottom: 1px solid #FFFFFF12;
}
.lightable-paper {
width: 100%;
margin-bottom: 10px;
color: #444;
}
.lightable-paper tfoot tr td {
border: 0;
}
.lightable-paper tfoot tr:first-child td {
border-top: 1px solid #00000020;
}
.lightable-paper thead tr:last-child th {
color: #666;
vertical-align: bottom;
border-bottom: 1px solid #00000020;
line-height: 1.15em;
padding: 10px 5px;
}
.lightable-paper td {
vertical-align: middle;
border-bottom: 1px solid #00000010;
line-height: 1.15em;
padding: 7px 5px;
}
.lightable-paper.lightable-hover tbody tr:hover {
background-color: #F9EEC1;
}
.lightable-paper.lightable-striped tbody tr:nth-child(even) {
background-color: #00000008;
}
.lightable-paper.lightable-striped tbody td {
border: 0;
}
</style>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">Broadcasting Explained</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(broadcast)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(kableExtra)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="co">#&gt; Warning: package &#39;kableExtra&#39; was built under R version 4.4.1</span></span></code></pre></div>
<p> </p>
<div id="introduction" class="section level1">
<h1>Introduction</h1>
<p>In the context of operations involving 2 (or more) arrays,
“broadcasting” refers to recycling array dimensions
<strong>without</strong> allocating additional memory or making needles
copies. This is considerably <strong>faster</strong> and <strong>more
memory-efficient</strong> than R’s regular dimensions repetition (and
similar) mechanisms, such as the mechanism utilized inside the
<code>outer()</code> function.</p>
<p>This article explains the concept of “broadcasting” in more detail. A
good understanding of atomic and recursive arrays in base ‘R’ is
somewhat essential to follow this article.</p>
<p> </p>
</div>
<div id="what-is-broadcasting-and-why-is-it-needed" class="section level1">
<h1>What is broadcasting and why is it needed?</h1>
<p>Let’s start with a simple example.<br />
Consider 2 orthogonal 1d arrays, namely the column vector <code>x</code>
and the row vector <code>y</code>:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>, <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">1</span>))</span>
<span id="cb2-2"><a href="#cb2-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span><span class="sc">*</span><span class="dv">10</span>, <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">5</span>))</span>
<span id="cb2-3"><a href="#cb2-3" tabindex="-1"></a><span class="fu">print</span>(x)</span>
<span id="cb2-4"><a href="#cb2-4" tabindex="-1"></a><span class="co">#&gt;      [,1]</span></span>
<span id="cb2-5"><a href="#cb2-5" tabindex="-1"></a><span class="co">#&gt; [1,]    1</span></span>
<span id="cb2-6"><a href="#cb2-6" tabindex="-1"></a><span class="co">#&gt; [2,]    2</span></span>
<span id="cb2-7"><a href="#cb2-7" tabindex="-1"></a><span class="co">#&gt; [3,]    3</span></span>
<span id="cb2-8"><a href="#cb2-8" tabindex="-1"></a><span class="co">#&gt; [4,]    4</span></span>
<span id="cb2-9"><a href="#cb2-9" tabindex="-1"></a><span class="co">#&gt; [5,]    5</span></span>
<span id="cb2-10"><a href="#cb2-10" tabindex="-1"></a><span class="fu">print</span>(y)</span>
<span id="cb2-11"><a href="#cb2-11" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb2-12"><a href="#cb2-12" tabindex="-1"></a><span class="co">#&gt; [1,]   10   20   30   40   50</span></span></code></pre></div>
<p>Suppose one wishes to compute the outer sum of these 2 vectors.</p>
<p>This won’t work in base ‘R’:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>x <span class="sc">+</span> y</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a>Error <span class="cf">in</span> x <span class="sc">+</span> y <span class="sc">:</span> non<span class="sc">-</span>conformable arrays</span></code></pre></div>
<p>When computing the outer sum of these orthogonal vectors, both
vectors need to be recycled to equal size in order to compute the outer
computation.<br />
I.e. <code>x</code> needs its single column to be recycled (in this
case) 5 times, and <code>y</code> needs its single row to be recycled 5
times, creating 2 conformable matrices.</p>
<p>‘R’ provides linear <strong>vector</strong> recycling, but not
recycling of array dimensions. Instead, in base ‘R’ we need to
<strong>replicate</strong> (and thus <strong>copy</strong>) the array
dimensions. This can be done manually, or using
<code>outer() |&gt; drop()</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>x[, <span class="fu">rep</span>(1L, 5L)] <span class="sc">+</span> y[<span class="fu">rep</span>(1L, 5L),]</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a><span class="co">#&gt; [1,]   11   21   31   41   51</span></span>
<span id="cb4-4"><a href="#cb4-4" tabindex="-1"></a><span class="co">#&gt; [2,]   12   22   32   42   52</span></span>
<span id="cb4-5"><a href="#cb4-5" tabindex="-1"></a><span class="co">#&gt; [3,]   13   23   33   43   53</span></span>
<span id="cb4-6"><a href="#cb4-6" tabindex="-1"></a><span class="co">#&gt; [4,]   14   24   34   44   54</span></span>
<span id="cb4-7"><a href="#cb4-7" tabindex="-1"></a><span class="co">#&gt; [5,]   15   25   35   45   55</span></span>
<span id="cb4-8"><a href="#cb4-8" tabindex="-1"></a></span>
<span id="cb4-9"><a href="#cb4-9" tabindex="-1"></a><span class="fu">outer</span>(x, y, <span class="st">&quot;+&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">drop</span>()</span>
<span id="cb4-10"><a href="#cb4-10" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb4-11"><a href="#cb4-11" tabindex="-1"></a><span class="co">#&gt; [1,]   11   21   31   41   51</span></span>
<span id="cb4-12"><a href="#cb4-12" tabindex="-1"></a><span class="co">#&gt; [2,]   12   22   32   42   52</span></span>
<span id="cb4-13"><a href="#cb4-13" tabindex="-1"></a><span class="co">#&gt; [3,]   13   23   33   43   53</span></span>
<span id="cb4-14"><a href="#cb4-14" tabindex="-1"></a><span class="co">#&gt; [4,]   14   24   34   44   54</span></span>
<span id="cb4-15"><a href="#cb4-15" tabindex="-1"></a><span class="co">#&gt; [5,]   15   25   35   45   55</span></span></code></pre></div>
<p> </p>
<p>When <code>x</code> and <code>y</code> are small arrays, like in the
above example, there is hardly a problem; but when <code>x</code> and
<code>y</code> become larger, the 3 matrices (<code>x</code> is
replicated to a matrix, <code>y</code> is replicated to a matrix, and
the result is also matrix) also become larger.</p>
<p>If the 3 matrices become too large, you may require more memory than
is available in your current system, resulting in a message like the
following:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="sc">&gt;</span> Error<span class="sc">:</span> cannot allocate vector of size</span></code></pre></div>
<p>The problem isn’t limited to available memory. As the object sizes
increase, the speed decreases. And let’s not forget that computational
inefficiency in general is also bad for the environment.</p>
<p> </p>
<div id="introducing-broadcasting" class="section level2">
<h2>Introducing Broadcasting</h2>
<p>In an operation like <code>outer(x, y, &quot;+&quot;)</code>, <code>x</code>
and <code>y</code> are replicated to become the same size. The thing is,
physical replication - and thus copying - of the dimensions of
<code>x</code> and <code>y</code> should not be necessary; they only
need to be recycled virtually.</p>
<p>Virtual recycling does not actually physically replicate
<code>x</code> and <code>y</code>. Instead, nested loops in ‘C’ and
‘C++’ are used to simulate a recycled array.<br />
This is similar to how ‘R’ recycles regular vectors.<br />
Virtual recycling requires no additional memory (apart from allocating
the final end result); it is much faster and much more memory efficient
than using the <code>outer()</code> function or something similar.</p>
<p>And <strong>that</strong> is what broadcasting does: broadcasting
provides <strong>fast</strong> virtual recycling of array dimensions in
the context of operations involving 2 (or more) arrays
<strong>without</strong> allocating additional memory.</p>
<p>In the earlier example, we used:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>x[, <span class="fu">rep</span>(1L, 5L)] <span class="sc">+</span> y[<span class="fu">rep</span>(1L, 5L),]</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; [1,]   11   21   31   41   51</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; [2,]   12   22   32   42   52</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt; [3,]   13   23   33   43   53</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; [4,]   14   24   34   44   54</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; [5,]   15   25   35   45   55</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="fu">outer</span>(x, y, <span class="st">&quot;+&quot;</span>) <span class="sc">|&gt;</span> <span class="fu">drop</span>()</span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; [1,]   11   21   31   41   51</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; [2,]   12   22   32   42   52</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; [3,]   13   23   33   43   53</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; [4,]   14   24   34   44   54</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; [5,]   15   25   35   45   55</span></span></code></pre></div>
<p>To compute the outer sum using broadcasting through the ‘broadcast’
package, we can do the following:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="fu">library</span>(broadcast)</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="fu">bc.num</span>(x, y, <span class="st">&quot;+&quot;</span>)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; [1,]   11   21   31   41   51</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; [2,]   12   22   32   42   52</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; [3,]   13   23   33   43   53</span></span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a><span class="co">#&gt; [4,]   14   24   34   44   54</span></span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a><span class="co">#&gt; [5,]   15   25   35   45   55</span></span></code></pre></div>
<p>The result is the same (as it should). But as the size of the
resulting array increases, the broadcasted functions become more and
more efficient in terms of both speed and memory, in comparison with
base ‘R’ approaches.</p>
<p>Benchmarks can be found on the website.</p>
<p> </p>
</div>
</div>
<div id="illustrating-broadcasting" class="section level1">
<h1>Illustrating Broadcasting</h1>
<p>In the previous example 2 orthogonal vectors were created:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a><span class="fu">print</span>(x)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a><span class="co">#&gt;      [,1]</span></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; [1,]    1</span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; [2,]    2</span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; [3,]    3</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt; [4,]    4</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; [5,]    5</span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="fu">print</span>(y)</span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt; [1,]   10   20   30   40   50</span></span></code></pre></div>
<p>Computing the broadcasted outer sum of <code>x</code> and
<code>y</code> produced the following:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="fu">bc.num</span>(x, y, <span class="st">&quot;+&quot;</span>)</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4] [,5]</span></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a><span class="co">#&gt; [1,]   11   21   31   41   51</span></span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a><span class="co">#&gt; [2,]   12   22   32   42   52</span></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a><span class="co">#&gt; [3,]   13   23   33   43   53</span></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co">#&gt; [4,]   14   24   34   44   54</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a><span class="co">#&gt; [5,]   15   25   35   45   55</span></span></code></pre></div>
<p>So what exactly does broadcasting compute here?</p>
<p>The following table illustrates what broadcasting does,
conceptually:</p>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[1] + y[1]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[1] + y[2]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[1] + y[3]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[1] + y[4]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[1] + y[5]
</td>
</tr>
<tr>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[2] + y[1]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[2] + y[2]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[2] + y[3]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[2] + y[4]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[2] + y[5]
</td>
</tr>
<tr>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[3] + y[1]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[3] + y[2]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[3] + y[3]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[3] + y[4]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[3] + y[5]
</td>
</tr>
<tr>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[4] + y[1]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[4] + y[2]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[4] + y[3]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[4] + y[4]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[4] + y[5]
</td>
</tr>
<tr>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[5] + y[1]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[5] + y[2]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[5] + y[3]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[5] + y[4]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[5] + y[5]
</td>
</tr>
</tbody>
</table>
<p>This is an example of a simple outer operation of 2 orthogonal
vectors. But broadcasting provided by the ‘broadcast’ package is not
limited to only those kinds of arrays.</p>
<p>Any 2 arrays with each no more than 16 dimensions are supported. And
any number of dimensions can be broadcasted simultaneously.</p>
<p> </p>
<p>Let’s broadcast a vector with a matrix.</p>
<p>Consider the following column vector:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">5</span> <span class="sc">*</span> <span class="dv">10</span>, <span class="at">dim =</span> <span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">1</span>))</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a><span class="fu">print</span>(x)</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a><span class="co">#&gt;      [,1]</span></span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a><span class="co">#&gt; [1,]   10</span></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a><span class="co">#&gt; [2,]   20</span></span>
<span id="cb10-6"><a href="#cb10-6" tabindex="-1"></a><span class="co">#&gt; [3,]   30</span></span>
<span id="cb10-7"><a href="#cb10-7" tabindex="-1"></a><span class="co">#&gt; [4,]   40</span></span>
<span id="cb10-8"><a href="#cb10-8" tabindex="-1"></a><span class="co">#&gt; [5,]   50</span></span></code></pre></div>
<p>And the following matrix:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>, <span class="dv">5</span>, <span class="dv">4</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a><span class="fu">print</span>(y)</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a><span class="co">#&gt; [1,]    1    6   11   16</span></span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a><span class="co">#&gt; [2,]    2    7   12   17</span></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co">#&gt; [3,]    3    8   13   18</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a><span class="co">#&gt; [4,]    4    9   14   19</span></span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a><span class="co">#&gt; [5,]    5   10   15   20</span></span></code></pre></div>
<p>Let’s see what happens if we sum them together using
broadcasting:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">bc.num</span>(x, y, <span class="st">&quot;+&quot;</span>)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a><span class="co">#&gt;      [,1] [,2] [,3] [,4]</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a><span class="co">#&gt; [1,]   11   16   21   26</span></span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a><span class="co">#&gt; [2,]   22   27   32   37</span></span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="co">#&gt; [3,]   33   38   43   48</span></span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="co">#&gt; [4,]   44   49   54   59</span></span>
<span id="cb12-7"><a href="#cb12-7" tabindex="-1"></a><span class="co">#&gt; [5,]   55   60   65   70</span></span></code></pre></div>
<p>What happens here is that <code>y</code> remains the same, but column
vector <code>x</code> is <strong>virtually</strong> recycled 4 times,
but without requiring 4 times more memory. This is also be illustrated
in the following table:</p>
<table>
<thead>
<tr>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
<th style="text-align:left;">
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[1] + y[1, 1]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[1] + y[1, 2]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[1] + y[1, 3]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[1] + y[1, 4]
</td>
</tr>
<tr>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[2] + y[2, 1]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[2] + y[2, 2]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[2] + y[2, 3]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[2] + y[2, 4]
</td>
</tr>
<tr>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[3] + y[3, 1]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[3] + y[3, 2]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[3] + y[3, 3]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[3] + y[3, 4]
</td>
</tr>
<tr>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[4] + y[4, 1]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[4] + y[4, 2]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[4] + y[4, 3]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[4] + y[4, 4]
</td>
</tr>
<tr>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[5] + y[5, 1]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[5] + y[5, 2]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[5] + y[5, 3]
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x[5] + y[5, 4]
</td>
</tr>
</tbody>
</table>
<p> </p>
</div>
<div id="broadcasting-limitations-and-rules" class="section level1">
<h1>Broadcasting limitations and rules</h1>
<p>The previous section used the examples of a simple outer operation
with 1d arrays and matrices, as they are easier to display on a flat
screen then 3d-arrays.<br />
But broadcasting provided by the ‘broadcast’ package is not limited to
only those kinds of arrays.</p>
<p>Any 2 arrays with each no more than 16 dimensions are supported. And
any number of dimensions can be broadcasted simultaneously.</p>
<p> </p>
<div id="conformability" class="section level2">
<h2>Conformability</h2>
<p>Broadcasted operations only work when 2 arrays are conformable for
broadcasting.</p>
<p>Consider again 2 arrays <code>x</code> and <code>y</code>, and their
dimensions given by <code>dim(x)</code> and <code>dim(y)</code>,
respectively.<br />
‘broadcast’ goes through <code>dim(x)</code> and <code>dim(y)</code>,
from left (i.e. first dimension / rows) to right (i.e. the last
dimension), and checks for each axis <code>i</code> if <strong>at least
one</strong> of the following conditions is TRUE:</p>
<ul>
<li><code>dim(x)[i]</code> and <code>dim(y)[i]</code> are equal;</li>
<li>either <code>dim(x)[i]</code> or <code>dim(y)[i]</code> is
<code>1</code>;</li>
<li>either <code>dim(x)[i]</code> or <code>dim(y)[i]</code> is
non-existing.</li>
</ul>
<p>if at least one of the above conditions is true for each and every
one of the dimensions of <code>x</code> and <code>y</code>, the 2 arrays
are compatible for broadcasted operations. If not, they are not
compatible, and attempting to perform a broadcasted operations results
in an error.</p>
<p>To illustrate, let’s check 2 arrays to see if they are
compatible:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>), <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>), <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">1</span>))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
dim(x)
</th>
<th style="text-align:right;">
dim(y)
</th>
<th style="text-align:left;">
compatible
</th>
<th style="text-align:left;">
reason
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
10
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
10
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
TRUE
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
equal
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
1
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
5
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
TRUE
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
either is 1
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
9
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
1
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
TRUE
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
either is 1
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
6
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
NA
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
TRUE
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
either is missing
</td>
</tr>
</tbody>
</table>
<p>As shown in the data.frame above, all dimensions of <code>x</code>
and <code>y</code> are compatible.<br />
Therefore, broadcasted binary operations involving <code>x</code> and
<code>y</code> can be performed.</p>
<p> </p>
<p>Now let’s look at another 2 arrays, and see if they are
compatible:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>), <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>), <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">5</span>, <span class="dv">2</span>))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
dim(x)
</th>
<th style="text-align:right;">
dim(y)
</th>
<th style="text-align:left;">
compatible
</th>
<th style="text-align:left;">
reason
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
10
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
10
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
TRUE
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
equal
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
1
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
5
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
TRUE
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
either is 1
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
9
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
2
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
FALSE
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
not equal &amp; neither is 1/missing
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
6
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
NA
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
TRUE
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
either is missing
</td>
</tr>
</tbody>
</table>
<p>One of the dimensions, namely the third dimension, is not compatible.
Therefore, these 2 arrays are <strong>not</strong> conformable for
broadcasted operations.</p>
<p> </p>
</div>
<div id="which-dimensions-are-broadcasted" class="section level2">
<h2>Which dimensions are broadcasted</h2>
<p>In the context of an operation involving exactly 2 arrays, this
sub-section explains which dimensions of which array is broadcasted, and
which dimension of which array is left as-is.<br />
There are 3 scenarios relevant for this explanation.</p>
<p> </p>
<p><strong>Scenario 1:</strong><br />
For some dimension <code>i</code>, <code>dim(x)[i]</code> and
<code>dim(y)[i]</code> are equal.<br />
In this scenario, no broadcasting needs to occur on that dimension for
either array.</p>
<p> </p>
<p><strong>Scenario 2:</strong><br />
For some dimension <code>i</code>, suppose <code>dim(x)[i] == 1</code>
and <code>dim(y)[i] &gt; 1</code>.<br />
Then dimension <code>dim(x)[i]</code> is <strong>broadcasted</strong> to
size <code>dim(y)[i]</code>.<br />
Similarly, if <code>dim(x)[i] &gt; 1</code> and
<code>dim(y)[i] == 1</code>, dimension <code>dim(y)[i]</code> is
<strong>broadcasted</strong> to size <code>dim(x)[i]</code>.</p>
<p> </p>
<p><strong>Scenario 3:</strong><br />
Finally, suppose for some dimension <code>i</code>,
<code>dim(x)[i] &gt; 1</code>, and <code>dim(y)[i]</code> is
non-existing.<br />
I.e., <code>x</code> has more dimensions than <code>y</code>.<br />
In this case, the missing dimension in <code>y</code> is replaced with a
dimensions of size <code>1</code>, and scenario 2 is used.<br />
Similarly, if <code>dim(y)[i] &gt; 1</code> and <code>dim(x)[i]</code>
is non-existing, the missing dimension in <code>x</code> is replaced
with a dimension of size <code>1</code> and we get back to scenario
2.</p>
<p>It does not matter how much difference there is between the number of
dimensions of <code>x</code> and the number of dimensions of
<code>y</code>: any number of missing dimensions will be replaced with
<code>1</code>, as long as the total number of dimensions for each array
does not exceed <code>16</code>.</p>
<p> </p>
<p><strong>Illustration</strong></p>
<p>To illustrate, let’s check 2 conformable arrays, and see which
dimension of which array is broadcasted by how much</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>), <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">9</span>, <span class="dv">6</span>))</span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> <span class="fu">array</span>(<span class="fu">rnorm</span>(<span class="dv">10</span>), <span class="fu">c</span>(<span class="dv">10</span>, <span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">1</span>))</span></code></pre></div>
<table>
<thead>
<tr>
<th style="text-align:right;">
i
</th>
<th style="text-align:right;">
dim(x)
</th>
<th style="text-align:right;">
dim(y)
</th>
<th style="text-align:left;">
broadcasted
</th>
<th style="text-align:left;">
reason
</th>
<th style="text-align:left;">
note
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
1
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
10
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
10
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
neither
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
equal
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
2
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
1
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
1
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
neither
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
equal
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
3
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
1
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
5
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
x
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
dim(x)[i] == 1
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
4
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
9
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
1
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
y
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
dim(y)[i] == 1
</td>
<td style="text-align:left;">
</td>
</tr>
<tr>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
5
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
6
</td>
<td style="text-align:right;border-left:1px solid;border-right:1px solid;">
NA
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
y
</td>
<td style="text-align:left;border-left:1px solid;border-right:1px solid;">
dim(y)[i] is missing
</td>
<td style="text-align:left;">
dim(y) is extended by 1
</td>
</tr>
</tbody>
</table>
<p>   </p>
</div>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
